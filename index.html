<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rustic Got Talent Calculator</title>
    <meta name="description" content="Calculate contestant scores in talent competitions based on judges' ratings and audience votes">
    <meta name="author" content="Lovable">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Reset and base styles */
        *, *::before, *::after {
            box-sizing: border-box;
            border-color: hsl(var(--border));
        }
        
        :root {
            /* Kingdom Dark Theme */
            --background: 240 10% 8%;
            --foreground: 42 85% 90%;
            --card: 240 8% 12%;
            --card-foreground: 42 85% 90%;
            --popover: 240 8% 12%;
            --popover-foreground: 42 85% 90%;
            --primary: 42 85% 55%;
            --primary-foreground: 240 10% 8%;
            --secondary: 240 6% 18%;
            --secondary-foreground: 42 85% 90%;
            --muted: 240 6% 16%;
            --muted-foreground: 42 30% 60%;
            --accent: 42 75% 45%;
            --accent-foreground: 240 10% 8%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 42 85% 90%;
            --border: 240 6% 20%;
            --input: 240 6% 16%;
            --ring: 42 85% 55%;
            
            /* Kingdom specific colors */
            --gold: 42 85% 55%;
            --gold-dark: 42 75% 45%;
            --royal-purple: 260 50% 35%;
            --kingdom-shadow: 240 20% 4%;
            
            --sidebar-background: 0 0% 98%;
            --sidebar-foreground: 240 5.3% 26.1%;
            --sidebar-primary: 240 5.9% 10%;
            --sidebar-primary-foreground: 0 0% 98%;
            --sidebar-accent: 240 4.8% 95.9%;
            --sidebar-accent-foreground: 240 5.9% 10%;
            --sidebar-border: 220 13% 91%;
            --sidebar-ring: 217.2 91.2% 59.8%;
            --radius: 0.5rem;
        }
        
        .light {
            /* Light Kingdom Theme */
            --background: 42 45% 96%;
            --foreground: 240 10% 15%;
            --card: 42 20% 98%;
            --card-foreground: 240 10% 15%;
            --popover: 42 20% 98%;
            --popover-foreground: 240 10% 15%;
            --primary: 42 85% 45%;
            --primary-foreground: 42 45% 96%;
            --secondary: 42 30% 92%;
            --secondary-foreground: 240 10% 15%;
            --muted: 42 20% 94%;
            --muted-foreground: 240 10% 45%;
            --accent: 42 75% 35%;
            --accent-foreground: 42 45% 96%;
            --destructive: 0 84.2% 50%;
            --destructive-foreground: 42 45% 96%;
            --border: 42 30% 85%;
            --input: 42 20% 94%;
            --ring: 42 85% 45%;
            
            /* Kingdom specific colors for light mode */
            --gold: 42 85% 45%;
            --gold-dark: 42 75% 35%;
            --royal-purple: 260 50% 55%;
            --kingdom-shadow: 240 20% 85%;
            
            --sidebar-background: 240 5.9% 10%;
            --sidebar-foreground: 240 4.8% 95.9%;
            --sidebar-primary: 224.3 76.3% 48%;
            --sidebar-primary-foreground: 0 0% 100%;
            --sidebar-accent: 240 3.7% 15.9%;
            --sidebar-accent-foreground: 240 4.8% 95.9%;
            --sidebar-border: 240 3.7% 15.9%;
            --sidebar-ring: 217.2 91.2% 59.8%;
        }
        
        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-family: 'Cormorant Garamond', serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Utility classes */
        .container {
  width: 100%;
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
  padding-left: 1rem;
  padding-right: 1rem;
}
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .gap-8 { gap: 2rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-h-screen { min-height: 100vh; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-8 { margin-top: 2rem; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 500; }
        .opacity-60 { opacity: 0.6; }
        .rounded-lg { border-radius: calc(var(--radius) - 2px); }
        .border { border-width: 1px; }
        .transition-colors { transition-property: color, background-color, border-color; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .hover\:opacity-80:hover { opacity: 0.8; }
        .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\:ring-2:focus { box-shadow: 0 0 0 2px hsl(var(--ring)); }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        
        /* Card styles */
        .card {
            background-color: hsl(var(--card));
            color: hsl(var(--card-foreground));
            border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) - 2px);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        /* Button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            font-weight: 500;
            transition: color, background-color, border-color, box-shadow 0.15s;
            cursor: pointer;
            border: none;
            padding: 0.5rem 1rem;
            height: 2.5rem;
        }
        
        .btn-primary {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }
        
        .btn-primary:hover {
            background-color: hsl(var(--primary) / 0.9);
        }
        
        .btn-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }
        
        .btn-secondary:hover {
            background-color: hsl(var(--secondary) / 0.8);
        }
        
        .btn-outline {
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }
        
        .btn-outline:hover {
            background-color: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }
        
        .btn-destructive {
            background-color: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
        }
        
        .btn-destructive:hover {
            background-color: hsl(var(--destructive) / 0.9);
        }
        
        /* Input styles */
        .input {
            display: flex;
            height: 2.5rem;
            width: 100%;
            border-radius: calc(var(--radius) - 2px);
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: border-color 0.15s;
            color: hsl(var(--foreground));
        }
        
        .input:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }
        
        .input::placeholder {
            color: hsl(var(--muted-foreground));
        }
        
        /* Label styles */
        .label {
            font-size: 0.875rem;
            font-weight: 500;
            line-height: 1;
            color: hsl(var(--foreground));
        }
        
        /* Toggle styles */
        .toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--muted-foreground));
            padding: 0.5rem 1rem;
            height: 2.25rem;
            min-width: 5rem;
        }
        
        .toggle:hover {
            background-color: hsl(var(--muted));
            border-color: hsl(var(--ring));
            transform: translateY(-1px);
        }
        
        .toggle.active {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border-color: hsl(var(--primary));
            font-weight: 600;
            box-shadow: 0 2px 8px hsl(var(--primary) / 0.3);
        }
        
        .toggle.active:hover {
            background-color: hsl(var(--primary) / 0.9);
            transform: translateY(-1px);
        }
        
        /* Special styles */
        .gradient-text {
            background: linear-gradient(135deg, hsl(var(--gold)), hsl(var(--royal-purple)));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Cinzel', serif;
        }
        
        .logo {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid hsl(var(--gold) / 0.3);
            box-shadow: 0 0 20px hsl(var(--gold) / 0.2);
        }
        
        /* Animations */
        @keyframes fade-in {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes scale-in {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px hsl(var(--gold) / 0.3); }
            50% { box-shadow: 0 0 30px hsl(var(--gold) / 0.5), 0 0 40px hsl(var(--gold) / 0.3); }
        }
        
        .animate-fade-in { animation: fade-in 0.6s ease-out; }
        .animate-scale-in { animation: scale-in 0.4s ease-out; }
        .animate-glow { animation: glow 2s ease-in-out infinite alternate; }
        
        /* Enhanced button styles */
        .btn-kingdom {
            background: linear-gradient(135deg, hsl(var(--gold-dark)), hsl(var(--gold)));
            color: hsl(var(--primary-foreground));
            box-shadow: 0 4px 15px hsl(var(--gold) / 0.3);
            border: 1px solid hsl(var(--gold) / 0.3);
            font-weight: 600;
            transform: scale(1);
            transition: all 0.2s ease;
        }
        
        .btn-kingdom:hover {
            background: linear-gradient(135deg, hsl(var(--gold)), hsl(var(--gold-dark)));
            transform: scale(1.05);
            box-shadow: 0 6px 25px hsl(var(--gold) / 0.4);
        }
        
        /* Space utility */
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .flex-1 { flex: 1 1 0%; }
        
        /* Enhanced card styling */
        .card {
            background-color: hsl(var(--card));
            color: hsl(var(--card-foreground));
            border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) - 2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        
        /* RTL support */
        html[dir="rtl"] {
            direction: rtl;
        }
        
        html[dir="rtl"] .text-left {
            text-align: right;
        }
        
        html[dir="rtl"] .text-right {
            text-align: left;
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:flex-row { flex-direction: row; }
            .md\:items-center { align-items: center; }
            .md\:justify-between { justify-content: space-between; }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
    
/* Mobile-specific tweaks */
@media (max-width: 640px) {
  .container {
    padding-left: 0.75rem !important;
    padding-right: 0.75rem !important;
    max-width: 100% !important;
  }

  .text-3xl { font-size: 1.5rem !important; line-height: 1.6 !important; }
  .text-lg { font-size: 1rem !important; line-height: 1.5 !important; }
  .text-2xl { font-size: 1.25rem !important; line-height: 1.5 !important; }

  /* Force single column layouts */
  .grid-cols-2, .grid-cols-3,
  .md\:grid-cols-2, .md\:grid-cols-3,
  .lg\:grid-cols-3 {
    grid-template-columns: 1fr !important;
  }

  /* Force column direction for flex layouts */
  .flex-col, .md\:flex-row {
    flex-direction: column !important;
  }

  /* Consistent mobile spacing */
  .gap-4, .gap-6, .gap-8 {
    gap: 1rem !important;
  }

  .p-6, .p-8 {
    padding: 1rem !important;
  }

  .px-4, .py-4, .py-8 {
    padding: 1rem !important;
  }

  /* Logo and header improvements */
  .logo {
    width: 2.5rem !important;
    height: 2.5rem !important;
  }

  /* Judge cards mobile layout */
  .judge-impact-controls {
    flex-direction: column !important;
    gap: 0.75rem !important;
    align-items: stretch !important;
  }

  .toggle {
    width: 100% !important;
    min-width: auto !important;
    justify-content: center !important;
    text-align: center !important;
    padding: 0.75rem 1rem !important;
  }

  /* Better spacing for mobile inputs */
  .mobile-input-group {
    gap: 0.75rem !important;
    flex-direction: column !important;
  }

  .mobile-input-group .flex-1 {
    width: 100% !important;
  }

  /* Fix header on mobile */
  .header-content {
    text-align: center !important;
    gap: 1rem !important;
  }

  .header-content .flex {
    flex-direction: column !important;
    align-items: center !important;
    text-align: center !important;
    gap: 1rem !important;
  }

  .header-controls {
    justify-content: center !important;
    margin-top: 0 !important;
    width: 100% !important;
  }

  /* Better button layout on mobile */
  .btn-kingdom {
    width: 100% !important;
    max-width: 320px !important;
    margin: 0 auto !important;
    display: block !important;
    padding: 1rem 2rem !important;
  }

  /* Fix input styling on mobile */
  .input {
    padding: 0.75rem !important;
    font-size: 1rem !important;
  }

  /* Better card spacing on mobile */
  .card {
    margin-bottom: 1rem !important;
    padding: 1rem !important;
  }

  /* Fix footer link styling on mobile */
  .footer-link {
    font-size: 0.875rem !important;
    line-height: 1.4 !important;
    padding: 0.75rem 1rem !important;
    text-align: center !important;
    display: block !important;
    margin: 0 auto !important;
    max-width: 320px !important;
  }

  /* Judge name input styling */
  .judge-name-input {
    font-size: 1rem !important;
    padding: 0.5rem !important;
    margin-bottom: 0.75rem !important;
  }

  /* Fairness dot positioning */
  .judge-fairness-indicator {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.5rem !important;
    margin: 0.5rem 0 !important;
  }
}

/* Fairness indicator styles */
.fairness-dot {
  display: inline-block;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  margin: 0 0.5rem;
  vertical-align: middle;
  border: 2px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.fairness-fair { background-color: #22c55e; }
.fairness-questionable { background-color: #eab308; }
.fairness-unfair { background-color: #ef4444; }

.judge-fairness-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  margin: 0.5rem 0;
  padding: 0.5rem;
  background: hsl(var(--muted) / 0.3);
  border-radius: calc(var(--radius) - 2px);
  font-size: 0.875rem;
  font-weight: 500;
}

/* Math explanation page styles */
.math-page {
  display: none;
}

.math-page.active {
  display: block;
}

.formula {
  background-color: hsl(var(--muted));
  padding: 1rem;
  border-radius: calc(var(--radius) - 2px);
  border-left: 4px solid hsl(var(--primary));
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  margin: 1rem 0;
}

.back-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}

/* Footer link styling */
.footer-link {
  color: hsl(var(--primary));
  text-decoration: none;
  font-weight: 500;
  padding: 0.5rem 1rem;
  border-radius: calc(var(--radius) - 2px);
  border: 1px solid hsl(var(--primary) / 0.3);
  background-color: hsl(var(--primary) / 0.1);
  transition: all 0.2s ease;
  display: inline-block;
  font-size: 0.95rem;
  line-height: 1.5;
}

.footer-link:hover {
  background-color: hsl(var(--primary) / 0.2);
  border-color: hsl(var(--primary) / 0.5);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px hsl(var(--primary) / 0.2);
}

@media (max-width: 640px) {
  .back-btn {
    position: relative;
    top: auto;
    left: auto;
    margin-bottom: 1rem;
    width: 100%;
  }

  .footer-link {
    font-size: 0.875rem !important;
    line-height: 1.4 !important;
    padding: 0.75rem !important;
    text-align: center !important;
    display: block !important;
    margin: 0 auto;
    max-width: 300px;
  }
}

</style>
</head>

<body>
    <div id="app" class="min-h-screen">
        <!-- Mathematical Explanation Page -->
        <div id="mathPage" class="math-page">
            <button id="backToMain" class="btn btn-outline back-btn" onclick="showMainApp()">← <span id="backToCalculator">Back to Calculator</span></button>
            <div class="container py-8">
                <div class="card p-6">
                    <h1 id="mathPageTitle" class="text-3xl font-bold gradient-text mb-6 text-center">Mathematical Methodology</h1>
                    
                    <div class="space-y-8">
                        <!-- Score Calculation -->
                        <section>
                            <h2 id="scoreCalcTitle" class="text-2xl font-bold mb-4">Score Calculation Method</h2>
                            <p id="scoreCalcDesc" class="mb-4">Our scoring system combines judges' evaluations with audience voting using a weighted average approach.</p>
                            
                            <h3 id="judgeScoreCalcTitle" class="text-lg font-medium mb-3">Judge Score Calculation</h3>
                            <div class="formula">
                                Judge Base Score = (Creativity + Quality + Σ Special Criteria) / (2 + Number of Special Criteria)
                                <br><br>
                                Judge Final Score = Judge Base Score × Impact Factor
                                <br>
                                where Impact Factor = 1.0 (Full Impact) or 0.5 (Half Impact)
                            </div>
                            
                            <h3 id="overallJudgesTitle" class="text-lg font-medium mb-3">Overall Judges Average</h3>
                            <div class="formula">
                                Overall Judges Average = Σ(Judge Final Scores) / Number of Judges
                            </div>
                            
                            <h3 id="audienceScoreCalcTitle" class="text-lg font-medium mb-3">Audience Score Calculation</h3>
                            <div class="formula">
                                Half Impact Audience = (Total Half Points / Half Voters) × 0.5
                                <br><br>
                                Full Impact Audience = Total Full Points / Full Voters
                                <br><br>
                                Total Audience Score = Half Impact Audience + Full Impact Audience
                            </div>
                            
                            <h3 id="finalScoreTitle" class="text-lg font-medium mb-3">Final Score</h3>
                            <div class="formula">
                                Final Score = min(Overall Judges Average + Total Audience Score, 10.0)
                            </div>
                        </section>

                        <!-- Fairness Analysis -->
                        <section>
                            <h2 id="fairnessAnalysisTitle" class="text-2xl font-bold mb-4">Fairness Analysis System</h2>
                            <p id="fairnessAnalysisDesc" class="mb-4">Our fairness analysis evaluates whether each judge's rating is statistically reasonable compared to their peers using standard deviation analysis.</p>
                            
                            <h3 id="statisticalMethodTitle" class="text-lg font-medium mb-3">Statistical Method</h3>
                            <p id="statisticalMethodDesc" class="mb-4">For each individual score from a judge, we:</p>
                            <ol class="list-decimal list-inside mb-4 space-y-2">
                                <li id="excludeCurrentJudge">Exclude the current judge's score from analysis</li>
                                <li id="calculateMeanStd">Calculate the mean (μ) and standard deviation (σ) of remaining scores</li>
                                <li id="compareScore">Compare the judge's score against statistical intervals</li>
                            </ol>
                            
                            <h3 id="mathFormulasTitle" class="text-lg font-medium mb-3">Mathematical Formulas</h3>
                            <div class="formula">
                                Let S = Current judge's score
                                <br>
                                Let X = Array of all other judges' scores
                                <br>
                                Let n = Number of other judges
                                <br><br>
                                Mean (μ) = Σ(Xi) / n
                                <br><br>
                                Standard Deviation (σ) = √[Σ(Xi - μ)² / n]
                            </div>
                            
                            <h3 id="fairnessClassificationTitle" class="text-lg font-medium mb-3">Fairness Classification</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3">
                                    <span class="fairness-dot fairness-fair"></span>
                                    <strong>Fair (Green):</strong>
                                    <span>S ∈ [μ - 1.0σ, μ + 1.0σ]</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="fairness-dot fairness-questionable"></span>
                                    <strong>Questionable (Yellow):</strong>
                                    <span>S ∈ [μ ± 1.0σ, μ ± 1.5σ] but not in green range</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="fairness-dot fairness-unfair"></span>
                                    <strong>Unfair (Red):</strong>
                                    <span>S &lt; (μ - 1.5σ) or S &gt; (μ + 1.5σ)</span>
                                </div>
                            </div>
                            
                            <h3 id="fairInterpretationTitle" class="text-lg font-medium mb-3 mt-6">Interpretation</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li id="greenDotMeaning"><strong>Green dots</strong> indicate the judge's score aligns well with peer consensus</li>
                                <li id="yellowDotMeaning"><strong>Yellow dots</strong> suggest the score is somewhat outside normal range but acceptable</li>
                                <li id="redDotMeaning"><strong>Red dots</strong> indicate potential bias, error, or significant disagreement with peers</li>
                            </ul>
                        </section>

                        <!-- Technical Implementation -->
                        <section>
                            <h2 id="technicalImplementationTitle" class="text-2xl font-bold mb-4">Technical Implementation</h2>
                            <p id="technicalImplementationDesc" class="mb-4">The fairness analysis updates dynamically as scores change, providing real-time feedback on judge consistency.</p>
                            
                            <h3 id="realTimeAnalysisTitle" class="text-lg font-medium mb-3">Real-time Analysis</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li id="fairnessRecalc">Fairness indicators recalculate instantly when any score is modified</li>
                                <li id="requiresThreeJudges">Analysis requires at least 3 judges for meaningful statistical comparison</li>
                                <li id="analyzeIndependently">Each scoring category (Creativity, Quality, Special Criteria) is analyzed independently</li>
                                <li id="visualFeedback">Visual feedback helps identify potential scoring inconsistencies immediately</li>
                            </ul>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp">
            <!-- Header -->
            <header class="p-6 border-b">
                <div class="container">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 header-content">
                        <div class="flex items-center gap-4">
                            <img src="src/assets/logo.png" alt="Rustic Kingdom Logo" class="logo">
                            <div>
                                <h1 id="title" class="text-3xl font-bold gradient-text">Rustic Got Talent Calculator</h1>
                                <p id="subtitle" class="text-lg opacity-60">Calculate contestant scores based on judges' ratings and audience votes</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 header-controls">
                            <button id="themeToggle" class="btn btn-outline">🌙</button>
                            <button id="languageToggle" class="btn btn-outline">العربية</button>
                        </div>
                    </div>
                    <p id="corpsMessage" class="text-center mt-4 text-sm opacity-60">With regards of COT</p>
                </div>
            </header>

        <!-- Main Content -->
        <main class="container py-8">
            <div class="grid gap-8">
                <!-- Judges Configuration -->
                <div class="card p-6">
                    <h2 id="judgesConfigTitle" class="text-2xl font-bold mb-6">Judges Configuration</h2>
                    
                    <div class="mb-6">
                        <label for="numJudges" id="numJudgesLabel" class="label mb-2 block">Number of Judges:</label>
                        <input type="number" id="numJudges" class="input" min="1" max="10" value="3">
                    </div>
                    
                    <div id="judgesContainer" class="grid gap-6 lg:grid-cols-3 md:grid-cols-2 grid-cols-1">
                        <!-- Judges will be populated here -->
                    </div>
                </div>

                <!-- Audience Voting -->
                <div class="card p-6">
                    <h2 id="audienceVotingTitle" class="text-2xl font-bold mb-6">Audience Voting</h2>
                    
                    <!-- Half Impact Audience -->
                    <div class="mb-6">
                        <h3 id="audienceHalfTitle" class="text-lg font-medium mb-4">Audience Voting (Half Impact)</h3>
                        <div class="grid gap-4 md:grid-cols-2">
                            <div>
                                <label for="halfAudienceVoters" id="numVotersHalfLabel" class="label mb-2 block">Number of Voters</label>
                                <input type="number" id="halfAudienceVoters" class="input" min="0" value="0">
                            </div>
                            <div>
                                <label for="halfAudiencePoints" id="totalPointsHalfLabel" class="label mb-2 block">Total Points</label>
                                <input type="number" id="halfAudiencePoints" class="input" min="0" value="0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Full Impact Audience -->
                    <div class="mb-6">
                        <h3 id="audienceFullTitle" class="text-lg font-medium mb-4">Audience Voting (Full Impact)</h3>
                        <div class="grid gap-4 md:grid-cols-2">
                            <div>
                                <label for="fullAudienceVoters" id="numVotersFullLabel" class="label mb-2 block">Number of Voters</label>
                                <input type="number" id="fullAudienceVoters" class="input" min="0" value="0">
                            </div>
                            <div>
                                <label for="fullAudiencePoints" id="totalPointsFullLabel" class="label mb-2 block">Total Points</label>
                                <input type="number" id="fullAudiencePoints" class="input" min="0" value="0">
                            </div>
                        </div>
                    </div>
                    
                    <p id="voterDescription" class="text-sm opacity-60">Each voter gives 1-10 points. Total = sum of all votes.</p>
                </div>

                <div class="text-center animate-fade-in">
                    <button id="calculateBtn" class="btn btn-kingdom text-lg px-8 py-4 animate-scale-in">Calculate Result</button>
                </div>

                <!-- Results -->
                <div id="resultsContainer" class="card p-6" style="display: none;">
                    <h2 id="resultsTitle" class="text-2xl font-bold mb-6">Results</h2>
                    
                    <div class="text-center mb-8">
                        <div class="text-4xl font-bold gradient-text mb-2">
                            <span id="finalScore">0.00</span>
                        </div>
                        <div id="outOfText" class="text-lg opacity-60">out of 10.00</div>
                    </div>
                    
                    <div class="grid gap-6 md:grid-cols-2">
                        <div>
                            <h3 id="scoreBreakdownTitle" class="text-lg font-medium mb-4">Score Breakdown</h3>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span id="judgesScoreLabel">Judges' Score:</span>
                                    <span id="judgesScore">0.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span id="audienceScoreLabel">Audience Score:</span>
                                    <span id="audienceScore">0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 id="detailedCalculationsTitle" class="text-lg font-medium mb-4">Detailed Calculations</h3>
                            <div id="calculationDetails" class="text-sm space-y-1">
                                <!-- Details will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Placeholder -->
                <div id="placeholder" class="card p-6 text-center">
                    <p id="placeholderText" class="opacity-60">Enter scores and click "Calculate Result" to see the final score and breakdown.</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t p-6">
            <div class="container text-center">
                <p class="text-sm mb-3">
                    <a href="#" id="mathLink" class="footer-link">
                        <span id="mathLinkText">View detailed mathematical calculations and fairness methodology</span>
                    </a>
                </p>
                <p id="copyright" class="text-sm opacity-60">© 2025 Rustic Kingdom 🗝️ | Developer: Adham</p>
            </div>
        </footer>
        </div>
    </div>

    <script>
        // State management
        let state = {
            theme: 'dark',
            language: 'en',
            numJudges: 3,
            judges: [],
            halfAudienceVoters: 0,
            halfAudiencePoints: 0,
            fullAudienceVoters: 0,
            fullAudiencePoints: 0,
            results: null
        };

        // Translations
        const translations = {
            en: {
                title: 'Rustic Got Talent Calculator',
                subtitle: 'Calculate contestant scores based on judges\' ratings and audience votes',
                corpsMessage: 'With regards of COT',
                judgesConfig: 'Judges Configuration',
                numJudges: 'Number of Judges:',
                judge: 'Judge',
                creativity: 'Creativity (0-10)',
                quality: 'Quality (0-10)',
                specialCriteria: 'Special Criteria',
                criteria: 'Criteria',
                halfImpact: 'Half Impact',
                fullImpact: 'Full Impact',
                impactToggle: 'Impact Level',
                audienceVoting: 'Audience Voting',
                audienceHalfImpact: 'Audience Voting (Half Impact)',
                audienceFullImpact: 'Audience Voting (Full Impact)',
                numVoters: 'Number of Voters',
                totalPoints: 'Total Points',
                voterDescription: 'Each voter gives 1-10 points. Total = sum of all votes.',
                calculateResult: 'Calculate Result',
                finalScore: 'Final Score',
                outOf: 'out of 10.00',
                scoreBreakdown: 'Score Breakdown',
                judgesScore: 'Judges\' Score',
                audienceScore: 'Audience Score',
                detailedCalculations: 'Detailed Calculations',
                judgeAverages: 'Judge Averages:',
                overallJudgesAverage: 'Overall Judges Average:',
                audienceAverage: 'Audience Average:',
                calculationNote1: '• Judges\' Score = Overall Judges Average × Impact',
                calculationNote2: '• Audience Score = Audience Average × Impact',
                calculationNote3: '• Final Score = Judges\' Score + Audience Score',
                enterScores: 'Enter scores and click "Calculate Result" to see the final score and breakdown.',
                copyright: '© 2025 Rustic Kingdom 🗝️ | Developer: Adham',
                mathLinkText: 'View detailed mathematical calculations and fairness methodology',
                backToCalculator: 'Back to Calculator',
                mathPageTitle: 'Mathematical Methodology',
                scoreCalcTitle: 'Score Calculation Method',
                scoreCalcDesc: 'Our scoring system combines judges\' evaluations with audience voting using a weighted average approach.',
                judgeScoreCalcTitle: 'Judge Score Calculation',
                overallJudgesTitle: 'Overall Judges Average',
                audienceScoreCalcTitle: 'Audience Score Calculation',
                finalScoreTitle: 'Final Score',
                fairnessAnalysisTitle: 'نظام تحليل العدالة',
                fairnessAnalysisDesc: 'تحليل العدالة لدينا يقيم ما إذا كان تقييم كل حكم معقولاً إحصائياً مقارنة بأقرانهم باستخدام تحليل الانحراف المعياري.',
                statisticalMethodTitle: 'الطريقة الإحصائية',
                statisticalMethodDesc: 'لكل نقطة فردية من حكم، نحن:',
                fairnessClassificationTitle: 'تصنيف العدالة',
                fairInterpretationTitle: 'التفسير',
                technicalImplementationTitle: 'التنفيذ التقني',
                technicalImplementationDesc: 'يتم تحديث تحليل العدالة ديناميكياً عند تغيير النقاط، مما يوفر ملاحظات فورية على اتساق الحكام.',
                realTimeAnalysisTitle: 'التحليل الفوري',
                excludeCurrentJudge: 'استبعاد نقطة الحكم الحالي من التحليل',
                calculateMeanStd: 'حساب المتوسط (μ) والانحراف المعياري (σ) للنقاط المتبقية',
                compareScore: 'مقارنة نقطة الحكم بالفترات الإحصائية',
                mathFormulasTitle: 'الصيغ الرياضية',
                greenDotMeaning: 'النقاط الخضراء تشير إلى أن نقطة الحكم تتماشى جيداً مع إجماع الأقران',
                yellowDotMeaning: 'النقاط الصفراء تشير إلى أن النقطة خارج المدى الطبيعي إلى حد ما ولكنها مقبولة',
                redDotMeaning: 'النقاط الحمراء تشير إلى تحيز محتمل أو خطأ أو خلاف كبير مع الأقران',
                fairnessRecalc: 'تُعيد مؤشرات العدالة الحساب فوراً عند تعديل أي نقطة',
                requiresThreeJudges: 'يتطلب التحليل ما لا يقل عن 3 حكام للمقارنة الإحصائية الهادفة',
                analyzeIndependently: 'يتم تحليل كل فئة تقييم (الإبداع، الجودة، المعايير الخاصة) بشكل مستقل',
                visualFeedback: 'الملاحظات البصرية تساعد في تحديد التناقضات المحتملة في التقييم فوراً',
                editJudgeName: 'تحرير اسم الحكم'
            },
            ar: {
                title: 'حاسبة مواهب راستيك',
                subtitle: 'احسب نقاط المتسابقين بناءً على تقييمات الحكام وأصوات الجمهور',
                corpsMessage: 'مع تحيات فيلق المواهب',
                judgesConfig: 'إعداد الحكام',
                numJudges: 'عدد الحكام:',
                judge: 'الحكم',
                creativity: 'الإبداع (0-10)',
                quality: 'الجودة (0-10)',
                specialCriteria: 'معايير خاصة',
                criteria: 'معيار',
                halfImpact: 'نصف التأثير',
                fullImpact: 'تأثير كامل',
                impactToggle: 'مستوى التأثير',
                audienceVoting: 'تصويت الجمهور',
                audienceHalfImpact: 'تصويت الجمهور (تأثير نصف)',
                audienceFullImpact: 'تصويت الجمهور (تأثير كامل)',
                numVoters: 'عدد المصوتين',
                totalPoints: 'إجمالي النقاط',
                voterDescription: 'كل مصوت يعطي 1-10 نقاط. الإجمالي = مجموع جميع الأصوات.',
                calculateResult: 'احسب النتيجة',
                finalScore: 'النتيجة النهائية',
                outOf: 'من 10.00',
                scoreBreakdown: 'تفصيل النقاط',
                judgesScore: 'نقاط الحكام',
                audienceScore: 'نقاط الجمهور',
                detailedCalculations: 'الحسابات التفصيلية',
                judgeAverages: 'متوسطات الحكام:',
                overallJudgesAverage: 'متوسط الحكام الإجمالي:',
                audienceAverage: 'متوسط الجمهور:',
                calculationNote1: '• نقاط الحكام = متوسط الحكام الإجمالي × التأثير',
                calculationNote2: '• نقاط الجمهور = متوسط الجمهور × التأثير',
                calculationNote3: '• النتيجة النهائية = نقاط الحكام + نقاط الجمهور',
                enterScores: 'أدخل النقاط واضغط "احسب النتيجة" لرؤية النتيجة النهائية والتفصيل.',
                copyright: '© 2025 مملكة ريستيك 🗝️ | المطور: أدهم',
                mathLinkText: 'عرض الحسابات الرياضية التفصيلية ومنهجية العدالة',
                backToCalculator: 'العودة إلى الحاسبة',
                mathPageTitle: 'المنهجية الرياضية',
                scoreCalcTitle: 'طريقة حساب النقاط',
                scoreCalcDesc: 'نظام التقييم لدينا يجمع بين تقييمات الحكام وتصويت الجمهور باستخدام متوسط مرجح.',
                judgeScoreCalcTitle: 'حساب نقاط الحكم',
                overallJudgesTitle: 'متوسط الحكام الإجمالي',
                audienceScoreCalcTitle: 'حساب نقاط الجمهور',
                finalScoreTitle: 'النتيجة النهائية',
                fairnessAnalysisTitle: 'نظام تحليل العدالة',
                fairnessAnalysisDesc: 'تحليل العدالة لدينا يقيم ما إذا كان تقييم كل حكم معقولاً إحصائياً مقارنة بأقرانهم باستخدام تحليل الانحراف المعياري.',
                statisticalMethodTitle: 'الطريقة الإحصائية',
                statisticalMethodDesc: 'لكل نقطة فردية من حكم، نحن:'
            }
        };

        // Translation function
        function t(key) {
            return translations[state.language][key] || key;
        }

        // Initialize judges
        function initializeJudges() {
            state.judges = Array.from({ length: state.numJudges }, (_, i) => ({
                id: i + 1,
                name: t('judge') + ' ' + (i + 1),
                creativity: 0,
                quality: 0,
                specialCriteria: [],
                halfWeight: false
            }));
        }

        // Calculate overall fairness for a judge based on all their scores
        function calculateJudgeFairness(judgeIndex) {
            if (state.numJudges < 3) return 'fair'; // Need at least 3 judges for meaningful analysis
            
            const judge = state.judges[judgeIndex];
            const allScores = [judge.creativity, judge.quality, ...judge.specialCriteria];
            const validScores = allScores.filter(score => score > 0);
            
            if (validScores.length === 0) return 'fair';
            
            let fairCount = 0;
            let questionableCount = 0;
            let unfairCount = 0;
            
            // Check creativity
            if (judge.creativity > 0) {
                const fairness = calculateIndividualFairness(judgeIndex, 'creativity', judge.creativity);
                if (fairness === 'fair') fairCount++;
                else if (fairness === 'questionable') questionableCount++;
                else unfairCount++;
            }
            
            // Check quality
            if (judge.quality > 0) {
                const fairness = calculateIndividualFairness(judgeIndex, 'quality', judge.quality);
                if (fairness === 'fair') fairCount++;
                else if (fairness === 'questionable') questionableCount++;
                else unfairCount++;
            }
            
            // Check special criteria
            judge.specialCriteria.forEach((criteria, cIndex) => {
                if (criteria > 0) {
                    const fairness = calculateIndividualFairness(judgeIndex, `criteria_${cIndex}`, criteria);
                    if (fairness === 'fair') fairCount++;
                    else if (fairness === 'questionable') questionableCount++;
                    else unfairCount++;
                }
            });
            
            const totalChecked = fairCount + questionableCount + unfairCount;
            if (totalChecked === 0) return 'fair';
            
            // Determine overall fairness based on majority
            if (unfairCount > totalChecked / 2) return 'unfair';
            if (questionableCount + unfairCount > fairCount) return 'questionable';
            return 'fair';
        }

        // Calculate fairness indicator for an individual score
        function calculateIndividualFairness(judgeIndex, scoreType, currentScore) {
            if (state.numJudges < 3) return 'fair'; // Need at least 3 judges for meaningful analysis
            
            // Get all scores from other judges for this score type
            const otherScores = state.judges
                .filter((_, index) => index !== judgeIndex)
                .map(judge => {
                    if (scoreType === 'creativity') return judge.creativity;
                    if (scoreType === 'quality') return judge.quality;
                    if (scoreType.startsWith('criteria_')) {
                        const criteriaIndex = parseInt(scoreType.split('_')[1]);
                        return judge.specialCriteria[criteriaIndex] || 0;
                    }
                    return 0;
                })
                .filter(score => score > 0); // Only consider non-zero scores
            
            if (otherScores.length < 2) return 'fair'; // Need at least 2 other scores
            
            // Calculate mean and standard deviation
            const mean = otherScores.reduce((sum, score) => sum + score, 0) / otherScores.length;
            const variance = otherScores.reduce((sum, score) => sum + Math.pow(score - mean, 2), 0) / otherScores.length;
            const stdDev = Math.sqrt(variance);
            
            // Avoid division by zero
            if (stdDev === 0) return 'fair';
            
            const score = parseFloat(currentScore) || 0;
            
            // Calculate fairness based on standard deviation ranges
            if (score >= mean - stdDev && score <= mean + stdDev) {
                return 'fair'; // Green: within 1 standard deviation
            } else if (score >= mean - 1.5 * stdDev && score <= mean + 1.5 * stdDev) {
                return 'questionable'; // Yellow: within 1.5 standard deviations
            } else {
                return 'unfair'; // Red: outside 1.5 standard deviations
            }
        }

        // Render judges with mobile-responsive layout and fairness indicators
        function renderJudges() {
            const container = document.getElementById('judgesContainer');
            container.innerHTML = '';

            state.judges.forEach((judge, index) => {
                const judgeCard = document.createElement('div');
                judgeCard.className = 'card p-4';
                
                // Calculate overall fairness for this judge
                const overallFairness = calculateJudgeFairness(index);
                
                judgeCard.innerHTML = `
                    <div class="flex flex-col gap-4 mb-4">
                        <div class="flex items-center justify-between gap-2">
                            <input type="text" class="input judge-name-input flex-1" 
                                   value="${judge.name}" 
                                   onchange="updateJudgeName(${index}, this.value)"
                                   placeholder="${t('editJudgeName')}">
                        </div>
                        
                        <div class="judge-fairness-indicator">
                            <span class="fairness-dot fairness-${overallFairness}"></span>
                            <span class="text-sm font-medium">
                                ${overallFairness === 'fair' ? (state.language === 'ar' ? 'عادل' : 'Fair') :
                                  overallFairness === 'questionable' ? (state.language === 'ar' ? 'مشكوك فيه' : 'Questionable') :
                                  (state.language === 'ar' ? 'غير عادل' : 'Unfair')}
                            </span>
                        </div>
                        
                        <div class="judge-impact-controls flex items-center gap-2">
                            <span class="text-sm">${t('impactToggle')}:</span>
                            <div class="flex gap-2 w-full">
                                <button class="toggle ${judge.halfWeight ? '' : 'active'}" 
                                        onclick="toggleJudgeWeight(${index}, false)">
                                    ${t('fullImpact')}
                                </button>
                                <button class="toggle ${judge.halfWeight ? 'active' : ''}" 
                                        onclick="toggleJudgeWeight(${index}, true)">
                                    ${t('halfImpact')}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="label mb-2 block">${t('creativity')}</label>
                            <input type="number" class="input" min="0" max="10" step="0.1" 
                                   value="${judge.creativity}" 
                                   onchange="updateJudgeField(${index}, 'creativity', this.value); renderJudges();">
                        </div>
                        
                        <div>
                            <label class="label mb-2 block">${t('quality')}</label>
                            <input type="number" class="input" min="0" max="10" step="0.1" 
                                   value="${judge.quality}" 
                                   onchange="updateJudgeField(${index}, 'quality', this.value); renderJudges();">
                        </div>
                        
                        <div>
                            <label class="label mb-2 block">${t('specialCriteria')}</label>
                            <div id="specialCriteria_${index}" class="space-y-2">
                                ${judge.specialCriteria.map((criteria, cIndex) => `
                                    <div class="flex gap-2 mobile-input-group">
                                        <div class="flex-1">
                                            <input type="number" class="input" min="0" max="10" step="0.1" 
                                                   value="${criteria}" 
                                                   onchange="updateSpecialCriteria(${index}, ${cIndex}, this.value); renderJudges();"
                                                   placeholder="${t('criteria')} ${cIndex + 1}">
                                        </div>
                                        <button class="btn btn-destructive" onclick="removeSpecialCriteria(${index}, ${cIndex})">×</button>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="btn btn-outline mt-2 w-full" onclick="addSpecialCriteria(${index})">
                                + ${t('criteria')}
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(judgeCard);
            });
        }

        // Update judge name
        function updateJudgeName(index, newName) {
            state.judges[index].name = newName || (t('judge') + ' ' + (index + 1));
        }

        // Update judge field
        function updateJudgeField(index, field, value) {
            state.judges[index][field] = parseFloat(value) || 0;
        }

        // Toggle judge weight
        function toggleJudgeWeight(index, halfWeight) {
            state.judges[index].halfWeight = halfWeight;
            renderJudges();
        }

        // Add special criteria
        function addSpecialCriteria(judgeIndex) {
            state.judges[judgeIndex].specialCriteria.push(0);
            renderJudges();
        }

        // Remove special criteria
        function removeSpecialCriteria(judgeIndex, criteriaIndex) {
            state.judges[judgeIndex].specialCriteria.splice(criteriaIndex, 1);
            renderJudges();
        }

        // Update special criteria
        function updateSpecialCriteria(judgeIndex, criteriaIndex, value) {
            state.judges[judgeIndex].specialCriteria[criteriaIndex] = parseFloat(value) || 0;
        }

        // Calculate results
        function calculateResults() {
            const judgeScores = state.judges.map(judge => {
                const baseScore = (judge.creativity + judge.quality + judge.specialCriteria.reduce((sum, c) => sum + c, 0)) / 
                                (2 + judge.specialCriteria.length);
                return baseScore * (judge.halfWeight ? 0.5 : 1);
            });

            const judgesAverage = judgeScores.reduce((sum, score) => sum + score, 0) / judgeScores.length || 0;

            // Calculate audience scores
            const halfAudienceAvg = state.halfAudienceVoters > 0 ? 
                (state.halfAudiencePoints / state.halfAudienceVoters) * 0.5 : 0;
            const fullAudienceAvg = state.fullAudienceVoters > 0 ? 
                (state.fullAudiencePoints / state.fullAudienceVoters) : 0;
            
            const totalAudienceScore = halfAudienceAvg + fullAudienceAvg;
            const finalScore = Math.min(judgesAverage + totalAudienceScore, 10);

            state.results = {
                finalScore,
                judgesScore: judgesAverage,
                audienceScore: totalAudienceScore,
                judgeScores,
                halfAudienceAvg,
                fullAudienceAvg
            };

            renderResults();
        }

        // Render results
        function renderResults() {
            if (!state.results) return;

            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('placeholder').style.display = 'none';

            document.getElementById('finalScore').textContent = state.results.finalScore.toFixed(2);
            document.getElementById('judgesScore').textContent = state.results.judgesScore.toFixed(2);
            document.getElementById('audienceScore').textContent = state.results.audienceScore.toFixed(2);

            const details = document.getElementById('calculationDetails');
            details.innerHTML = `
                <div>${t('judgeAverages')}</div>
                ${state.results.judgeScores.map((score, i) => `
                    <div>• ${t('judge')} ${i + 1}: ${score.toFixed(2)}</div>
                `).join('')}
                <div class="mt-2">${t('overallJudgesAverage')} ${state.results.judgesScore.toFixed(2)}</div>
                <div>${t('audienceAverage')} ${state.results.audienceScore.toFixed(2)}</div>
                <div class="mt-2">
                    <div>${t('calculationNote1')}</div>
                    <div>${t('calculationNote2')}</div>
                    <div>${t('calculationNote3')}</div>
                </div>
            `;
        }

        // Toggle theme
        function toggleTheme() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            document.documentElement.className = state.theme;
            document.getElementById('themeToggle').textContent = state.theme === 'dark' ? '☀️' : '🌙';
            localStorage.setItem('theme', state.theme);
        }

        // Toggle language
        function toggleLanguage() {
            state.language = state.language === 'en' ? 'ar' : 'en';
            document.documentElement.dir = state.language === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('languageToggle').textContent = state.language === 'en' ? 'العربية' : 'English';
            localStorage.setItem('language', state.language);
            updateTranslations();
        }

        // Update translations
        function updateTranslations() {
            // Update static text elements
            document.getElementById('title').textContent = t('title');
            document.getElementById('subtitle').textContent = t('subtitle');
            document.getElementById('corpsMessage').textContent = t('corpsMessage');
            document.getElementById('judgesConfigTitle').textContent = t('judgesConfig');
            document.getElementById('numJudgesLabel').textContent = t('numJudges');
            document.getElementById('audienceVotingTitle').textContent = t('audienceVoting');
            document.getElementById('audienceHalfTitle').textContent = t('audienceHalfImpact');
            document.getElementById('audienceFullTitle').textContent = t('audienceFullImpact');
            document.getElementById('numVotersHalfLabel').textContent = t('numVoters');
            document.getElementById('totalPointsHalfLabel').textContent = t('totalPoints');
            document.getElementById('numVotersFullLabel').textContent = t('numVoters');
            document.getElementById('totalPointsFullLabel').textContent = t('totalPoints');
            document.getElementById('voterDescription').textContent = t('voterDescription');
            document.getElementById('calculateBtn').textContent = t('calculateResult');
            document.getElementById('resultsTitle').textContent = t('finalScore');
            document.getElementById('outOfText').textContent = t('outOf');
            document.getElementById('scoreBreakdownTitle').textContent = t('scoreBreakdown');
            document.getElementById('judgesScoreLabel').textContent = t('judgesScore') + ':';
            document.getElementById('audienceScoreLabel').textContent = t('audienceScore') + ':';
            document.getElementById('detailedCalculationsTitle').textContent = t('detailedCalculations');
            document.getElementById('placeholderText').textContent = t('enterScores');
            document.getElementById('copyright').textContent = t('copyright');
            document.getElementById('mathLinkText').textContent = t('mathLinkText');
            
            // Update math page translations
            document.getElementById('backToCalculator').textContent = t('backToCalculator');
            document.getElementById('mathPageTitle').textContent = t('mathPageTitle');
            document.getElementById('scoreCalcTitle').textContent = t('scoreCalcTitle');
            document.getElementById('scoreCalcDesc').textContent = t('scoreCalcDesc');
            document.getElementById('judgeScoreCalcTitle').textContent = t('judgeScoreCalcTitle');
            document.getElementById('overallJudgesTitle').textContent = t('overallJudgesTitle');
            document.getElementById('audienceScoreCalcTitle').textContent = t('audienceScoreCalcTitle');
            document.getElementById('finalScoreTitle').textContent = t('finalScoreTitle');
            document.getElementById('fairnessAnalysisTitle').textContent = t('fairnessAnalysisTitle');
            document.getElementById('fairnessAnalysisDesc').textContent = t('fairnessAnalysisDesc');
            document.getElementById('statisticalMethodTitle').textContent = t('statisticalMethodTitle');
            document.getElementById('statisticalMethodDesc').textContent = t('statisticalMethodDesc');
            
            // Update additional math page elements
            const excludeEl = document.getElementById('excludeCurrentJudge');
            if (excludeEl) excludeEl.textContent = t('excludeCurrentJudge');
            const calculateEl = document.getElementById('calculateMeanStd');
            if (calculateEl) calculateEl.textContent = t('calculateMeanStd');
            const compareEl = document.getElementById('compareScore');
            if (compareEl) compareEl.textContent = t('compareScore');
            const mathFormulasEl = document.getElementById('mathFormulasTitle');
            if (mathFormulasEl) mathFormulasEl.textContent = t('mathFormulasTitle');
            const fairnessClassEl = document.getElementById('fairnessClassificationTitle');
            if (fairnessClassEl) fairnessClassEl.textContent = t('fairnessClassificationTitle');
            const interpretEl = document.getElementById('fairInterpretationTitle');
            if (interpretEl) interpretEl.textContent = t('fairInterpretationTitle');
            const techImplEl = document.getElementById('technicalImplementationTitle');
            if (techImplEl) techImplEl.textContent = t('technicalImplementationTitle');
            const techDescEl = document.getElementById('technicalImplementationDesc');
            if (techDescEl) techDescEl.textContent = t('technicalImplementationDesc');
            const realTimeEl = document.getElementById('realTimeAnalysisTitle');
            if (realTimeEl) realTimeEl.textContent = t('realTimeAnalysisTitle');
            const greenDotEl = document.getElementById('greenDotMeaning');
            if (greenDotEl) greenDotEl.innerHTML = `<strong>${state.language === 'ar' ? 'النقاط الخضراء' : 'Green dots'}</strong> ${t('greenDotMeaning').replace('<strong>Green dots</strong> ', '')}`;
            const yellowDotEl = document.getElementById('yellowDotMeaning');
            if (yellowDotEl) yellowDotEl.innerHTML = `<strong>${state.language === 'ar' ? 'النقاط الصفراء' : 'Yellow dots'}</strong> ${t('yellowDotMeaning').replace('<strong>Yellow dots</strong> ', '')}`;
            const redDotEl = document.getElementById('redDotMeaning');
            if (redDotEl) redDotEl.innerHTML = `<strong>${state.language === 'ar' ? 'النقاط الحمراء' : 'Red dots'}</strong> ${t('redDotMeaning').replace('<strong>Red dots</strong> ', '')}`;
            const fairnessRecalcEl = document.getElementById('fairnessRecalc');
            if (fairnessRecalcEl) fairnessRecalcEl.textContent = t('fairnessRecalc');
            const requiresEl = document.getElementById('requiresThreeJudges');
            if (requiresEl) requiresEl.textContent = t('requiresThreeJudges');
            const analyzeEl = document.getElementById('analyzeIndependently');
            if (analyzeEl) analyzeEl.textContent = t('analyzeIndependently');
            const visualEl = document.getElementById('visualFeedback');
            if (visualEl) visualEl.textContent = t('visualFeedback');

            // Re-render judges to update their translations
            renderJudges();
            if (state.results) {
                renderResults();
            }
        }

        // Navigation functions
        function showMathPage() {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('mathPage').classList.add('active');
        }

        function showMainApp() {
            document.getElementById('mathPage').classList.remove('active');
            document.getElementById('mainApp').style.display = 'block';
        }

        // Initialize app
        function init() {
            // Load saved preferences
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const savedLanguage = localStorage.getItem('language') || 'en';
            
            state.theme = savedTheme;
            state.language = savedLanguage;
            
            document.documentElement.className = state.theme;
            document.documentElement.dir = state.language === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('themeToggle').textContent = state.theme === 'dark' ? '☀️' : '🌙';
            document.getElementById('languageToggle').textContent = state.language === 'en' ? 'العربية' : 'English';

            // Initialize judges
            initializeJudges();
            renderJudges();
            updateTranslations();

            // Event listeners
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('languageToggle').addEventListener('click', toggleLanguage);
            document.getElementById('calculateBtn').addEventListener('click', calculateResults);
            document.getElementById('mathLink').addEventListener('click', function(e) {
                e.preventDefault();
                showMathPage();
            });
            document.getElementById('backToMain').addEventListener('click', showMainApp);
            
            document.getElementById('numJudges').addEventListener('change', function() {
                state.numJudges = parseInt(this.value) || 1;
                initializeJudges();
                renderJudges();
            });

            document.getElementById('halfAudienceVoters').addEventListener('change', function() {
                state.halfAudienceVoters = parseInt(this.value) || 0;
            });

            document.getElementById('halfAudiencePoints').addEventListener('change', function() {
                state.halfAudiencePoints = parseFloat(this.value) || 0;
            });

            document.getElementById('fullAudienceVoters').addEventListener('change', function() {
                state.fullAudienceVoters = parseInt(this.value) || 0;
            });

            document.getElementById('fullAudiencePoints').addEventListener('change', function() {
                state.fullAudiencePoints = parseFloat(this.value) || 0;
            });
        }

        // Start the app
        init();
    </script>
</body>
</html>
